
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://nus-cs2030.github.io/1718-s2/monad/index.html">
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Extra. Build a Monad - CS2030 Programming Methodology II</title>
      
    
    
      <script src="../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-769c285a91.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="https://nus-cs2030.github.io/1718-s2" title="CS2030 Programming Methodology II" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Lectures
                </span>
              
            
            Extra. Build a Monad
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/nus-cs2030/1718-s2" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    CS2030 Programming Methodology II
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/nus-cs2030/1718-s2" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      General
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        General
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/index.html" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prereqs/index.html" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../policies/index.html" title="Policies" class="md-nav__link">
      Policies
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../schedule/index.html" title="Schedule" class="md-nav__link">
      Schedule
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../readings/index.html" title="Readings" class="md-nav__link">
      Readings
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../final/index.html" title="Final" class="md-nav__link">
      Final
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../midterm/index.html" title="Midterm" class="md-nav__link">
      Midterm
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lab0/index.html" title="0. Warm Up" class="md-nav__link">
      0. Warm Up
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab1a/index.html" title="1a. Simulator v1.0" class="md-nav__link">
      1a. Simulator v1.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab1b/index.html" title="1b. Simulator v1.1" class="md-nav__link">
      1b. Simulator v1.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab2a/index.html" title="2a. Simulator v1.2" class="md-nav__link">
      2a. Simulator v1.2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab2b/index.html" title="2b. Simulator v1.3" class="md-nav__link">
      2b. Simulator v1.3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab3/index.html" title="3.  Infinite List" class="md-nav__link">
      3.  Infinite List
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab4a/index.html" title="4a. Simulator v2.0" class="md-nav__link">
      4a. Simulator v2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab4b/index.html" title="4b. Simulator v2.1" class="md-nav__link">
      4b. Simulator v2.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab5/index.html" title="5.  Matrix Multiplication" class="md-nav__link">
      5.  Matrix Multiplication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab6/index.html" title="6.  Async Web API" class="md-nav__link">
      6.  Async Web API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      Lectures
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Lectures
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lec01/index.html" title="1. Abstraction & Encapsulation" class="md-nav__link">
      1. Abstraction & Encapsulation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec02/index.html" title="2. Interface, Inheritance & Polymorphism" class="md-nav__link">
      2. Interface, Inheritance & Polymorphism
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec03/index.html" title="3. More on Inheritance" class="md-nav__link">
      3. More on Inheritance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec04/index.html" title="4. Types, Memory, Exception" class="md-nav__link">
      4. Types, Memory, Exception
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec05/index.html" title="5. Generics and Collections" class="md-nav__link">
      5. Generics and Collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec06/index.html" title="6. hashCode, Nested Class, enum" class="md-nav__link">
      6. hashCode, Nested Class, enum
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec07/index.html" title="7. Functions" class="md-nav__link">
      7. Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec08/index.html" title="8. Streams" class="md-nav__link">
      8. Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec09/index.html" title="9. FP Patterns" class="md-nav__link">
      9. FP Patterns
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec10/index.html" title="10. Parallel streams" class="md-nav__link">
      10. Parallel streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec11/index.html" title="11. Asynchronous" class="md-nav__link">
      11. Asynchronous
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Extra. Build a Monad
      </label>
    
    <a href="index.html" title="Extra. Build a Monad" class="md-nav__link md-nav__link--active">
      Extra. Build a Monad
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#making-it-a-monad" title="Making It A Monad" class="md-nav__link">
    Making It A Monad
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-a-generic-monad-that-logs" title="Making a Generic Monad that Logs" class="md-nav__link">
    Making a Generic Monad that Logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functor" title="Functor" class="md-nav__link">
    Functor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wait-what-is-a-monad-again" title="Wait, What is a Monad Again?" class="md-nav__link">
    Wait, What is a Monad Again?
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../style/index.html" title="Coding Style" class="md-nav__link">
      Coding Style
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Software/Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Software/Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../jdk/index.html" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../javadoc/index.html" title="Javadoc" class="md-nav__link">
      Javadoc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unix/index.html" title="UNIX" class="md-nav__link">
      UNIX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vim/index.html" title="Vim" class="md-nav__link">
      Vim
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#making-it-a-monad" title="Making It A Monad" class="md-nav__link">
    Making It A Monad
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-a-generic-monad-that-logs" title="Making a Generic Monad that Logs" class="md-nav__link">
    Making a Generic Monad that Logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functor" title="Functor" class="md-nav__link">
    Functor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wait-what-is-a-monad-again" title="Wait, What is a Monad Again?" class="md-nav__link">
    Wait, What is a Monad Again?
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nus-cs2030/1718-s2/edit/master/docs/monad.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <h1 id="extra-do-you-want-to-build-a-monad">Extra: Do You Want to Build a Monad?</h1>
<p>This article is inspired by (The Best Introduction to Monad)[<a href="https://blog.jcoglan.com/2011/03/05/translation-from-haskell-to-javascript-of-selected-portions-of-the-best-introduction-to-monads-ive-ever-read/#">https://blog.jcoglan.com/2011/03/05/translation-from-haskell-to-javascript-of-selected-portions-of-the-best-introduction-to-monads-ive-ever-read/#</a>], but is adapted to the OO-context with Java.</p>
<p>Let's say we have:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">double</span> <span class="nf">sin</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">sin</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">double</span> <span class="nf">cube</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>We can easily chain the methods together:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">sin</span><span class="o">(</span><span class="n">cube</span><span class="o">(</span><span class="mf">5.0</span><span class="o">));</span>
<span class="n">cube</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="mf">5.0</span><span class="o">));</span>
</pre></div>
</td></tr></table>

<p>But, what if we need to print something while doing this operation?</p>
<p>We can easily do:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">double</span> <span class="nf">sin</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;called sin&quot;</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">sin</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">double</span> <span class="nf">cube</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;called cubed&quot;</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>But that has side effects, so it violates the spirit of functional programming.
We should concat the logs into a string (just like what you did in Lab 4).  So we need a class that encapsulates the variable with its log.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">DoubleString</span> <span class="o">{</span>
  <span class="n">Double</span> <span class="n">x</span><span class="o">;</span>
  <span class="n">String</span> <span class="n">log</span><span class="o">;</span>

  <span class="n">DoubleString</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">=</span> <span class="n">log</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Now, we can write the methods as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">DoubleString</span> <span class="nf">sinAndLog</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">),</span> <span class="s">&quot;called sin&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">DoubleString</span> <span class="nf">cubeAndLog</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="n">cube</span><span class="o">(</span><span class="n">x</span><span class="o">),</span> <span class="s">&quot;called cube&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>In a way, we are writing methods that take in a value (<code class="codehilite">double x</code>) and add some context to it (the log).  We wrap both the value and its context in a box (the <code class="codehilite">DoubleString</code>).</p>
<p>But these new functions do not compose anymore.  We cannot do <code class="codehilite">sinAndLog(cubeAndLog(x))</code> </p>
<p>We need methods that takes in a <code class="codehilite">DoubleString</code> and return a <code class="codehilite">DoubleString</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">DoubleString</span> <span class="nf">sinAndLog</span><span class="o">(</span><span class="n">DoubleString</span> <span class="n">ds</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">ds</span><span class="o">.</span><span class="na">x</span><span class="o">),</span> <span class="n">ds</span><span class="o">.</span><span class="na">log</span> <span class="o">+</span> <span class="s">&quot;called sin&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">DoubleString</span> <span class="nf">cubeAndLog</span><span class="o">(</span><span class="n">DoubleString</span> <span class="n">ds</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="n">cube</span><span class="o">(</span><span class="n">ds</span><span class="o">.</span><span class="na">x</span><span class="o">),</span> <span class="n">ds</span><span class="o">.</span><span class="na">log</span> <span class="o">+</span> <span class="s">&quot;called cube&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Great, now we can write the methods to compose them:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">sinAndLog</span><span class="o">(</span><span class="n">cubeAndLog</span><span class="o">(</span><span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="mf">5.0</span><span class="o">,</span><span class="s">&quot;&quot;</span><span class="o">)));</span>
</pre></div>
</td></tr></table>

<p>or in the OO-way</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">DoubleString</span> <span class="o">{</span>
  <span class="n">Double</span> <span class="n">x</span><span class="o">;</span>
  <span class="n">String</span> <span class="n">log</span><span class="o">;</span>

  <span class="n">DoubleString</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">=</span> <span class="n">log</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="n">DoubleString</span> <span class="nf">sinAndLog</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span><span class="o">),</span> <span class="n">log</span> <span class="o">+</span> <span class="s">&quot;called sin&quot;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="n">DoubleString</span> <span class="nf">cubeAndLog</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="n">cube</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span><span class="o">),</span> <span class="n">log</span> <span class="o">+</span> <span class="s">&quot;called cube&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>In the OO-way, we chain the methods together.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="mf">5.0</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">).</span><span class="na">sinAndLog</span><span class="o">().</span><span class="na">cubeAndLog</span><span class="o">();</span>
</pre></div>
</td></tr></table>

<h2 id="making-it-a-monad">Making It A Monad</h2>
<p>Now, here is where I <em>jump to creating a monad</em>.  I do not want to convert all my methods that takes in <code class="codehilite">double</code> and returns <code class="codehilite">DoubleString</code> into something that takes in <code class="codehilite">DoubleString</code> and returns <code class="codehilite">DoubleString</code>.  Yet, I want to be able to compose them and chain them together.  So I write a general method that allows that, and that is our <code class="codehilite">flatMap</code> method:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="n">DoubleString</span> <span class="nf">flatMap</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">DoubleString</span><span class="o">&gt;</span> <span class="n">mapper</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">DoubleString</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="n">ds</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="na">log</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>
</td></tr></table>

<p>We can now use <code class="codehilite">flatMap</code> to chain different operations together.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>DoubleString ds = new DoubleString(5.0, &quot;&quot;)
    .flatMap(x -&gt; sinAndLog(x))
    .flatMap(x -&gt; cubeAndLog(x));
</pre></div>
</td></tr></table>

<p>Now <code class="codehilite">DoubleString</code> is a monad!</p>
<p>Going back to our "wrap a value in a box with context" explanation.  If we have two such wrappers, how do we wrap twice?  We have to (i) wrap it one time, (ii) unwrap to get the new value and <em>new context</em>, and wrap it again.  </p>
<p>The two lines in <code class="codehilite">flatMap</code> corresponds to (i) and (ii) respectively.</p>
<p>Line <code class="codehilite">ds = mapper.apply(x);</code> wraps it once; The next line unwraps the value and the context (<code class="codehilite">ds.x</code> and <code class="codehilite">dx.log</code>) and wraps it again (
<code class="codehilite">new DoubleString(..)</code>) with the next context (<code class="codehilite">this.log + &quot;\n&quot; + ds.log</code>).</p>
<p>Here is our monad:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">DoubleString</span> <span class="o">{</span>
  <span class="n">Double</span> <span class="n">x</span><span class="o">;</span>
  <span class="n">String</span> <span class="n">log</span><span class="o">;</span>

  <span class="n">DoubleString</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">=</span> <span class="n">log</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="n">DoubleString</span> <span class="nf">flatMap</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">DoubleString</span><span class="o">&gt;</span> <span class="n">mapper</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">DoubleString</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">DoubleString</span><span class="o">(</span><span class="n">ds</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="na">log</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="n">log</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h2 id="making-a-generic-monad-that-logs">Making a Generic Monad that Logs</h2>
<p>We can make <code class="codehilite">DoubleString</code> a generic class that logs what happen to a variable.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Logger</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="n">x</span><span class="o">;</span>
  <span class="n">String</span> <span class="n">log</span><span class="o">;</span>

  <span class="n">Logger</span><span class="o">(</span><span class="n">T</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">=</span> <span class="n">log</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">Logger</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">flatMap</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="n">Logger</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">R</span><span class="o">&gt;&gt;</span> <span class="n">mapper</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Logger</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Logger</span><span class="o">&lt;&gt;(</span><span class="n">ds</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="na">log</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="n">log</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h2 id="functor">Functor</h2>
<p>Can we do this with a functor?  Note that a functor has a <code class="codehilite">map</code> method with type <code class="codehilite">Function&lt;T,R&gt;</code>.  A <code class="codehilite">map</code> method for <code class="codehilite">DoubleString</code> would looks like <code class="codehilite">Function&lt;Double,Double&gt;</code>.  So it cannot do what the monad does.  A functor can only change the value inside the box, but it cannot rewrap it with an updated context.</p>
<h2 id="wait-what-is-a-monad-again">Wait, What is a Monad Again?</h2>
<p>I hope the example above helps explain what is a monad -- it is a value wrapped in a box with context, and it allows us to compose wrappers (wrap multuple times), operate on its value and update the context if needed.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../lec11/index.html" title="11. Asynchronous" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                11. Asynchronous
              </span>
            </div>
          </a>
        
        
          <a href="../style/index.html" title="Coding Style" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Coding Style
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright by Wei Tsang Ooi, Department of Computer Science, National University of Singapore 2018
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>